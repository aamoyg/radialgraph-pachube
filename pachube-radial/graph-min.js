function radialGraph(){var a=this;a.init=function(b){if(b!=undefined){a.element=b}else{return}a.canvas=undefined;a.data=undefined;a.numdata=undefined;a.settings={resource:a.element.attributes["pachube-resource"].value,api_key:a.element.attributes["pachube-key"].value,FaceColor:"grey",LineColor:"black",InnerColor:"white",OuterColor:"white",BackgroundColor:"#fff",TimeSpan:"24 hours",ShowClock:true,Font:(a.element.style.font||"9pt Arial")};a.parse_pachube_options(a.element.attributes["pachube-options"].value);a.clocktime=(a.settings.TimeSpan=="24 hours");graphId="radgraph"+Math.floor(Math.random()*100000);a.element.innerHTML='<canvas id="'+graphId+'"></canvas>';a.c=document.getElementById(graphId);a.b=document.body;a.a=a.c.getContext("2d");a.width=a.c.width=(parseInt(a.element.style.width)||100);a.height=a.c.height=(parseInt(a.element.style.height)||100);a.centerX=a.width/2;a.centerY=a.height/2;a.radius=a.width/2.2;a.msg="( synchronizing )";a.data=undefined;a.updatePachube();a.draw();if(a.settings.ShowClock||a.numdata==undefined){setInterval(a.draw,1000)}};a.draw=function(){a.a.clearRect(0,0,a.width,a.height);a.a.restore();a.plotClockFace();if(a.settings.ShowClock){a.plotClockHands()}a.plotDataPoints()};a.updateData=function(){a.gradient1=a.a.createRadialGradient(0,0,0,0,0,a.radius);a.gradient1.addColorStop(0,a.hex2rgb(a.settings.InnerColor,1));a.gradient1.addColorStop(1,a.hex2rgb(a.settings.OuterColor,0.5));a.gradient2=a.a.createRadialGradient(0,0,0,0,0,a.radius);a.gradient2.addColorStop(0,a.hex2rgb(a.settings.InnerColor,0.5));a.gradient2.addColorStop(1,a.hex2rgb(a.settings.OuterColor,0.6));a.numdata=[],a.datedata=[];min=9999999999,max=0;for(var c=0;c<a.data.length;c+=1){var b=parseFloat(a.data[c].value);max=(max<b)?b:max;min=(min>b)?b:min;a.numdata.push(b);a.datedata.push(new Date(a.data[c].at))}a.scale=a.radius/(max-min);a.min=min;a.max=max};a.plotDataPoints=function(){if(a.data==undefined){return}if(a.numdata==undefined){a.updateData()}a.a.save();a.a.translate(a.centerX,a.centerY);a.a.fillStyle=a.gradient1;a.a.strokeStyle=a.settings.LineColor;a.a.lineWidth=1;a.a.beginPath();a.plotDataRange(0,Math.floor(a.numdata.length/2));a.a.fill();a.a.beginPath();a.a.fillStyle=a.gradient2;a.plotDataRange(Math.ceil(a.numdata.length/2),a.numdata.length);a.a.stroke();a.a.fill();a.a.restore()};a.plotDataRange=function(g,b){var f=false,e=null;for(var c=g;c<b;c++){amount=(a.numdata[c]-a.min)*a.scale;a.clocktime=true;if(a.clocktime){d=a.datedata[c];dH=d.getHours()+(d.getMinutes()/60)+(d.getSeconds()/3600);delta=dH/12}else{d=new Date();dH=d.getHours()+(d.getMinutes()/60)+(d.getSeconds()/3600);delta=(dH/12)+(c/a.numdata.length)}dx1=amount*Math.sin(6.28*delta);dy1=amount*-Math.cos(6.28*delta);if(!f){e=[dx1,dy1];f=true;a.a.moveTo(dx1,dy1)}else{a.a.lineTo(dx1,dy1)}}if(f){a.a.lineTo(e[0],e[1])}};a.plotClockFace=function(){a.a.save();a.a.translate(a.centerX,a.centerY);a.a.strokeStyle=a.settings.FaceColor;a.a.fillStyle=a.settings.BackgroundColor;a.a.lineWidth=3;a.a.beginPath();a.a.arc(0,0,a.radius,0,Math.PI*2,false);a.a.stroke();a.a.fill();a.a.font=a.settings.Font;a.a.fillStyle=a.settings.FaceColor;a.a.fillText(a.msg,-a.msg.length*3,-a.radius-8);a.a.restore()};a.plotClockHands=function(){a.a.save();a.a.translate(a.centerX,a.centerY);a.a.strokeStyle="rgba(0,0,0,0.3)";a.a.lineWidth=a.radius/10;d=new Date();dS=d.getSeconds()/60;dM=(d.getMinutes()+dS)/60;dH=(d.getHours()+dM)/12;pi2=Math.PI*2;a.a.beginPath();a.a.moveTo(0,0);dx1=0.9*a.radius*Math.sin(pi2*dH);dy1=0.9*a.radius*-Math.cos(pi2*dH);a.a.lineTo(dx1,dy1);a.a.stroke();a.a.beginPath();a.a.moveTo(0,0);dx1=a.radius*Math.sin(pi2*dM);dy1=a.radius*-Math.cos(pi2*dM);a.a.lineTo(dx1,dy1);a.a.stroke();a.a.beginPath();a.a.arc(0,0,a.radius*0.95,-pi2/4,(pi2*((dS==0)?1:dS))-pi2/4,false);a.a.stroke();a.a.restore()};a.parse_pachube_options=function(b){if(b==undefined){b=""}options_hash=new Array();re=/([^:]*):([^;]*);/;while(match=b.match(re)){b=b.replace(re,"");options_hash[match[1].trim()]=match[2].trim()}a.settings.FaceColor=(options_hash["text-color"]||"#555555");a.settings.LineColor=(options_hash["line-color"]||"#0000ff");a.settings.InnerColor=(options_hash["grid-color"]||"#03030b");a.settings.OuterColor=(options_hash["border-color"]||"#a000ff");a.settings.BackgroundColor=(options_hash["background-color"]||"#ffffff");a.settings.TimeSpan=(options_hash.timespan||"24 hours");a.settings.ShowClock=(options_hash.showclock!="no")};a.set_interval=function(b){switch(b){case"3 months":a.settings.Interval=86400*60;return"3month";case"4 days":a.settings.Interval=6000*60;return"4day";case"last hour":a.settings.Interval=500*60;return"1hour";default:case"24 hours":a.settings.Interval=2000*60;a.settings.TimeSpan="24 hours";return"24hour"}};a.updatePachube=function(){var b=a.set_interval(a.settings.TimeSpan);if(typeof console!="undefined"){console.log("Updating Pachube data: "+a.settings.resource+" - next in "+a.settings.Interval/1000+"s")}if(a.settings.Interval>0){setTimeout(a.updatePachube,a.settings.Interval)}jQuery.getJSON("http://api.pachube.com/v2/"+a.settings.resource+".json?duration="+b+"&key="+a.settings.api_key,function(c){a.numdata=undefined;a.data=c.datapoints;a.msg=a.settings.TimeSpan})};a.hex2rgb=function(f,c){var b=f.replace("#","").match(/(.{2})/g);var e=3;while(e--){b[e]=parseInt(b[e],16)}if(typeof c=="undefined"){return"rgb("+b.join(", ")+")"}return"rgba("+b.join(", ")+", "+c+")"}}if(typeof jQuery==="undefined"){var script_tag=document.createElement("script");script_tag.setAttribute("type","text/javascript");script_tag.setAttribute("src","http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js");script_tag.onload=startRadialGraph;script_tag.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){startRadialGraph(false)}};document.getElementsByTagName("head")[0].appendChild(script_tag)}else{startRadialGraph(true)}function startRadialGraph(a){jQuery(document).ready(function(b){b(".pachube-radial").each(function(){if(b(this).hasClass("p-r-init")){return}b(this).addClass("p-r-init");(new radialGraph()).init(this)})})};